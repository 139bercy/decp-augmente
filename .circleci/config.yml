---
version: 2
jobs:
  install_requirements1:
    docker:
      - image: 139bercy/decp-rama
    resource_class: large
    steps:
      - checkout
      - restore_cache:
          keys:
            - dependencies1-{{ .Branch }}
      - run:
          name: Installation des requirements
          command: |
            python3 -m venv venv
            . venv/bin/activate
            pip install -r requirements1.txt
      - save_cache:
          key: dependencies1-{{ .Branch }}
          paths:
            - "venv"
  test_multiples_cache:
      docker:
        - image: 139bercy/decp-rama
      resource_class: large
      steps:
        - checkout
        - restore_cache:
            keys: test-{{ .Branch }}
        - run:
            name: test
            command: |
                python3 test.py

dependencies1-{{ .Branch }}



workflows:
  version: 2
  main:
    jobs:
      - install_requirements1
      - get_data_daily:
          requires:
            - install_requirements
      - gestion_flux:
          requires:
            - get_data_daily

  daily-data:
    jobs:
      - get_data_daily
    triggers:
      - schedule:
          cron: 0 4 * * 1-6
          filters:
            branches:
              only:
                - master
  weekly-data:
    jobs:
      - get_data_weekly
    triggers:
      - schedule:
          cron: 0 4 * * 1
          filters:
            branches:
              only:
                - master

  daily-compute:
    jobs:
      - get_data_daily
      - get_data_weekly
      - install_requirements
      - gestion_flux:
          requires:
            - install_requirements
    triggers:
      - schedule:
          cron: 0 7 * * 2-6
          filters:
            branches:
              only:
                - master